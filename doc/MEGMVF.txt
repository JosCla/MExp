.Game MVEF

Lbl MVEF {
    .Fully moves an entity (game version)
    .   (This version is used in the final game - draws between ticks)
    .r1: Entity pointer
    .r2: DispX
    .r3: DispY
    .r4: Layers of indirection from player push

    .Allocating stack
    S-2->S
    A->{S}^r

    .Moving the original entity
    MVEN()

    .A is now the number of actions in the previous queue frame
    0->A

    .Performing successive movements
    While U
        .Moving next queue frame into the stack
        If A
            A*5->G
            U*5->H
            -H+S->I
            CPRV(I,I+G,H)
        End
        A-U*5+S->S

        .Storing the previous number of frame actions in A
        U->A

        .Redrawing the screen between ticks
        .   The double DispGraph^r maintains draw parity.
        DRPL()
        DispGraph^r
        DispGraph^r

        .Advancing a single tick
        MVET(A)
    End

    .Restoring stack
    A*5+S->S
    {S}^r->A
    S+2->S

    Return
}
